<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–∑–∞–û–∫–Ω–æ–º ‚Äî –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ================= –ü–ï–†–ï–ú–ï–ù–ù–´–ï –¢–ï–ú ================= */
        :root[data-theme="dark"] {
            --bg-color: #000;
            --text-color: #fff;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --accent-color: #60a5fa;
            --card-sub-bg: rgba(255, 255, 255, 0.02);
        }

        :root[data-theme="light"] {
            --bg-color: #f8fafc;
            --text-color: #0f172a;
            --glass-bg: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(15, 23, 42, 0.1);
            --accent-color: #2563eb;
            --card-sub-bg: #fff;
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        .container {
            width: 100%;
            padding: 20px 15px;
            max-width: 500px; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
            margin: 0 auto;
        }

        /* HEADER */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        h1 { font-size: 1.5rem; font-weight: 800; letter-spacing: -1px; }
        .city-label { font-size: 0.9rem; opacity: 0.6; text-transform: uppercase; }

        /* –ì–õ–ê–í–ù–´–ô –ë–õ–û–ö */
        .main-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 30px 20px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(20px);
        }

        .temp-now {
            font-size: 5rem;
            font-weight: 200;
            margin: 10px 0;
            line-height: 1;
        }

        .status-text {
            font-size: 1.2rem;
            color: var(--accent-color);
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* –°–ï–¢–ö–ê –ü–ê–†–ê–ú–ï–¢–†–û–í */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 15px 5px;
            text-align: center;
        }

        .stat-box span { display: block; }
        .stat-val { font-weight: 700; font-size: 1.1rem; }
        .stat-label { font-size: 0.7rem; opacity: 0.5; text-transform: uppercase; margin-top: 4px; }

        /* –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô –ü–†–û–ì–ù–û–ó */
        .forecast-scroll {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 15px;
            scrollbar-width: none; /* Firefox */
        }
        .forecast-scroll::-webkit-scrollbar { display: none; }

        .day-card {
            min-width: 85px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 15px 10px;
            text-align: center;
            flex-shrink: 0;
        }

        .day-card.active {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
        }

        /* –ì–†–ê–§–ò–ö */
        .chart-container {
            height: 200px;
            margin-top: 20px;
        }

        /* –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ –¢–ï–ú–´ (–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π) */
        .theme-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        #fixed-detail-pane {
            margin-top: 20px;
            padding: 20px;
            background: var(--glass-bg);
            border-radius: 25px;
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div>
                <div class="city-label">–ö—É—Ä–≥–∞–Ω</div>
                <h1>–∑–∞–û–∫–Ω–æ–º</h1>
            </div>
            <button class="theme-btn" onclick="toggleTheme()" id="theme-btn">–°–≤–µ—Ç–ª–∞—è</button>
        </header>

        <div class="main-card">
            <div id="e-now" style="font-size: 3rem;">‚òÄÔ∏è</div>
            <div class="temp-now"><span id="t-now">--</span>¬∞</div>
            <div class="status-text" id="s-now">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div style="opacity: 0.6; font-size: 0.9rem;" id="f-now">–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ --¬∞</div>

            <div class="chart-container">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <span id="wind-s" class="stat-val">0</span>
                <span class="stat-label">–í–µ—Ç–µ—Ä –º/—Å</span>
            </div>
            <div class="stat-box">
                <span id="press-v" class="stat-val">0</span>
                <span class="stat-label">–î–∞–≤–ª–µ–Ω–∏–µ</span>
            </div>
            <div class="stat-box">
                <span id="hum-v" class="stat-val">0</span>
                <span class="stat-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</span>
            </div>
        </div>

        <div style="margin-bottom: 15px; font-weight: 700; font-size: 0.9rem; opacity: 0.5;">–ü–†–û–ì–ù–û–ó –ù–ê 2 –ù–ï–î–ï–õ–ò</div>
        <div class="forecast-scroll" id="main-grid"></div>

        <div id="fixed-detail-pane">
            <div style="margin-bottom: 15px; font-weight: 700;">–î–µ—Ç–∞–ª—å–Ω–æ –∑–∞ –¥–µ–Ω—å</div>
            <div class="chart-container" style="height: 180px;">
                <canvas id="subChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // ... (–õ–æ–≥–∏–∫–∞ JS –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ—á—Ç–∏ —Ç–∞–∫–æ–π –∂–µ, –∫–∞–∫ —É —Ç–µ–±—è, –Ω–æ —Å –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π –ø–æ–¥ –Ω–æ–≤—ã–µ ID) ...
        const LAT = 55.45, LON = 65.34;
        let globalData = null;
        let mainChart = null;
        let secondaryChart = null;

        const WEATHER_CODES = {
            0: { t: "–Ø—Å–Ω–æ", e: "‚òÄÔ∏è" }, 1: { t: "–Ø—Å–Ω–æ", e: "üå§Ô∏è" }, 2: { t: "–û–±–ª–∞—á–Ω–æ", e: "‚õÖ" },
            3: { t: "–ü–∞—Å–º—É—Ä–Ω–æ", e: "‚òÅÔ∏è" }, 45: { t: "–¢—É–º–∞–Ω", e: "üå´Ô∏è" }, 61: { t: "–î–æ–∂–¥—å", e: "üåßÔ∏è" },
            71: { t: "–°–Ω–µ–≥", e: "‚ùÑÔ∏è" }, 95: { t: "–ì—Ä–æ–∑–∞", e: "‚õàÔ∏è" }
        };

        async function startApp() {
            try {
                const api = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m,relative_humidity_2m,pressure_msl&daily=temperature_2m_max,temperature_2m_min&hourly=temperature_2m&timezone=auto&forecast_days=14`;
                const response = await fetch(api);
                globalData = await response.json();
                updateUI();
                renderMainGraph();
                renderForecast();
            } catch (err) { console.error("–û—à–∏–±–∫–∞ API", err); }
        }

        function updateUI() {
            const cur = globalData.current;
            document.getElementById('t-now').innerText = Math.round(cur.temperature_2m);
            document.getElementById('s-now').innerText = WEATHER_CODES[cur.weather_code]?.t || "–Ø—Å–Ω–æ";
            document.getElementById('e-now').innerText = WEATHER_CODES[cur.weather_code]?.e || "‚òÄÔ∏è";
            document.getElementById('f-now').innerText = `–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ${Math.round(cur.apparent_temperature)}¬∞`;
            document.getElementById('wind-s').innerText = Math.round(cur.wind_speed_10m);
            document.getElementById('press-v').innerText = Math.round(cur.pressure_msl * 0.75006);
            document.getElementById('hum-v').innerText = cur.relative_humidity_2m + '%';
        }

        function renderForecast() {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = '';
            for (let i = 0; i < 14; i++) {
                const date = new Date(globalData.daily.time[i]);
                const card = document.createElement('div');
                card.className = 'day-card';
                card.innerHTML = `
                    <div style="font-size: 0.7rem; opacity: 0.7;">${date.toLocaleDateString('ru-RU', {weekday:'short'})}</div>
                    <div style="font-weight: 700; margin: 5px 0;">${date.getDate()}</div>
                    <div style="font-size: 1rem; font-weight: 800;">${Math.round(globalData.daily.temperature_2m_max[i])}¬∞</div>
                `;
                card.onclick = () => {
                    document.querySelectorAll('.day-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    showDetails(i);
                };
                grid.appendChild(card);
            }
        }

        function renderMainGraph() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const isLight = document.documentElement.getAttribute('data-theme') === 'light';
            const accent = isLight ? '#2563eb' : '#60a5fa';

            if (mainChart) mainChart.destroy();
            mainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: globalData.hourly.time.slice(0, 12).map(t => new Date(t).getHours() + ":00"),
                    datasets: [{
                        data: globalData.hourly.temperature_2m.slice(0, 12),
                        borderColor: accent,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { display: false } }, y: { display: false } }
                }
            });
        }

        function showDetails(idx) {
            const pane = document.getElementById('fixed-detail-pane');
            pane.style.display = 'block';
            const ctx = document.getElementById('subChart').getContext('2d');
            const start = idx * 24;
            const data = globalData.hourly.temperature_2m.slice(start, start + 24);

            if (secondaryChart) secondaryChart.destroy();
            secondaryChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 24}, (_, i) => i + ":00"),
                    datasets: [{ data: data, borderColor: '#60a5fa', tension: 0.4 }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
            pane.scrollIntoView({ behavior: 'smooth' });
        }

        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            document.getElementById('theme-btn').innerText = isDark ? '–¢–µ–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';
            renderMainGraph();
        }

        startApp();
    </script>
</body>
</html>
