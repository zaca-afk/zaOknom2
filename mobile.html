<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Weather Pro ‚Äî Kurgan Fixed</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020617;
            --card: rgba(30, 41, 59, 0.6);
            --accent: #0ea5e9;
            --sun: #f59e0b;
            --text-dim: #94a3b8;
            --temp-cold: #3b82f6;
            --temp-hot: #f43f5e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: #fff;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –ó–í–ï–ó–î–ù–´–ô –§–û–ù */
        #stars-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.2); }
        }

        .container { width: 100%; max-width: 900px; padding: 20px; z-index: 1; }

        .header { text-align: center; margin: 30px 0 40px; }
        .city { font-size: 2.2rem; font-weight: 700; margin-bottom: 5px; }
        .temp-main { font-size: 7.5rem; font-weight: 200; position: relative; display: inline-block; }
        .temp-main::after { content: "¬∞"; position: absolute; top: 10px; right: -35px; font-size: 4rem; }
        .feels-like { font-size: 1.1rem; color: var(--text-dim); margin-top: 10px; }

        /* –ì–†–ò–î –°–¢–†–û–ì–û –û–î–ò–ù–ê–ö–û–í–´–• –ö–í–ê–î–†–ê–¢–û–í */
        .widget-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        @media (min-width: 768px) { .widget-grid { grid-template-columns: repeat(4, 1fr); } }

        .widget {
            background: var(--card);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 28px;
            padding: 18px;
            /* –°–¢–†–û–ì–ò–ô –ö–í–ê–î–†–ê–¢ */
            aspect-ratio: 1 / 1;
            width: 100%;
            min-width: 0; /* –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å–ø–∏—Ä–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
        }

        .label {
            font-size: 0.7rem; font-weight: 800; color: var(--text-dim);
            text-transform: uppercase; letter-spacing: 1px;
            display: flex; align-items: center; gap: 6px;
        }

        .visual-box {
            flex: 1;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* –ú–ê–ù–û–ú–ï–¢–† */
        .gauge-svg { width: 100%; height: 100%; }
        .tick { stroke: rgba(255,255,255,0.2); stroke-width: 3; stroke-linecap: round; }
        .tick-bold { stroke: rgba(255,255,255,0.6); stroke-width: 4; }

        .val-display { position: absolute; bottom: 0; width: 100%; text-align: center; }
        .val-num { font-size: 1.5rem; font-weight: 800; display: block; line-height: 1; }
        .val-unit { font-size: 0.65rem; color: var(--text-dim); font-weight: 700; text-transform: uppercase; }

        /* –í–ï–¢–ï–† */
        .wind-svg { width: 90%; height: 90%; }
        .needle-main { fill: #fff; filter: drop-shadow(0 0 5px var(--accent)); }

        /* –í–õ–ê–ñ–ù–û–°–¢–¨ */
        .hum-svg { width: 80%; transform: rotate(-90deg); }
        .hum-fill { fill: none; stroke: var(--accent); stroke-width: 4; stroke-linecap: round; transition: 2s; }

        /* –ü–†–û–ì–ù–û–ó */
        .forecast { background: var(--card); backdrop-filter: blur(15px); border-radius: 28px; border: 1px solid rgba(255, 255, 255, 0.1); padding: 5px 20px; }
        .f-row {
            display: grid;
            grid-template-columns: 85px 40px 1fr 90px;
            align-items: center; padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            gap: 10px;
        }
        .f-row:last-child { border: none; }
        .f-day { font-size: 0.9rem; font-weight: 600; text-transform: capitalize; }
        .f-icon { font-size: 1.4rem; text-align: center; }

        .f-bar-container { height: 4px; background: rgba(255,255,255,0.1); border-radius: 10px; position: relative; }
        .f-bar-fill { position: absolute; height: 100%; border-radius: 10px; background: linear-gradient(90deg, var(--temp-cold), var(--temp-hot)); }

        .f-temps { text-align: right; font-weight: 700; font-size: 1rem; }
        .f-min { color: var(--text-dim); margin-right: 10px; }
    </style>
</head>
<body>

<div id="stars-container"></div>

<div class="container">
    <div class="header">
        <div class="city">–ö—É—Ä–≥–∞–Ω</div>
        <div class="temp-main" id="cur-temp">--</div>
        <div class="feels-like" id="feels-text">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>
    </div>

    <div class="widget-grid">
        <div class="widget">
            <div class="label">üß≠ –í–µ—Ç–µ—Ä</div>
            <div class="visual-box">
                <svg viewBox="0 0 100 100" class="wind-svg">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="2"/>
                    <g font-size="8" font-weight="900" fill="var(--text-dim)" text-anchor="middle">
                        <text x="50" y="12">N</text><text x="88" y="53">E</text>
                        <text x="50" y="93">S</text><text x="12" y="53">W</text>
                    </g>
                    <g id="wind-needle" style="transform-origin: 50px 50px; transition: 2s;">
                        <path d="M 50 15 L 42 50 L 50 45 L 58 50 Z" class="needle-main" />
                        <circle cx="50" cy="50" r="3" fill="var(--accent)" />
                    </g>
                </svg>
                <div class="val-display">
                    <span class="val-num" id="wind-val">--</span>
                    <span class="val-unit">–º/—Å</span>
                </div>
            </div>
        </div>

        <div class="widget">
            <div class="label">‚è≤Ô∏è –î–∞–≤–ª–µ–Ω–∏–µ</div>
            <div class="visual-box">
                <svg viewBox="0 0 100 100" class="gauge-svg" id="p-gauge"></svg>
                <div class="val-display">
                    <span class="val-num" id="p-val">--</span>
                    <span class="val-unit">–º–º —Ä—Ç. —Å—Ç.</span>
                </div>
            </div>
        </div>

        <div class="widget">
            <div class="label">üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
            <div class="visual-box">
                <svg viewBox="0 0 36 36" class="hum-svg">
                    <circle cx="18" cy="18" r="16" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="3"/>
                    <circle id="hum-fill" cx="18" cy="18" r="16" class="hum-fill" stroke-dasharray="0 100" />
                </svg>
                <div style="position: absolute; font-size: 1.6rem; font-weight: 800;" id="hum-val">--%</div>
            </div>
            <div class="val-display"><span class="val-unit">–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è</span></div>
        </div>

        <div class="widget">
            <div class="label">‚òÄÔ∏è –°–æ–ª–Ω—Ü–µ</div>
            <div class="visual-box" style="align-items: flex-end;">
                <svg viewBox="0 0 100 50" style="width:100%; height:60%;">
                    <path d="M 10 45 A 40 35 0 0 1 90 45" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2" stroke-dasharray="4 4"/>
                    <path id="sun-path" d="M 10 45 A 40 35 0 0 1 90 45" fill="none" stroke="var(--sun)" stroke-width="3" stroke-linecap="round" stroke-dasharray="0 200"/>
                    <circle id="sun-dot" r="4" fill="var(--sun)" cx="-10" />
                </svg>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 0.7rem; font-weight: 800; padding-top: 5px;">
                <span id="rise">--:--</span>
                <span id="set">--:--</span>
            </div>
        </div>
    </div>

    <div class="forecast" id="forecast-list">
        <div class="label" style="padding: 15px 0 5px;">üìÖ –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 14 –¥–Ω–µ–π</div>
    </div>
</div>

<script>
    const CITY = { lat: 55.44, lon: 65.34 };
    const ICONS = { 0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 61: "üåßÔ∏è", 71: "‚ùÑÔ∏è", 95: "‚õàÔ∏è" };

    function createStars() {
        const container = document.getElementById('stars-container');
        for (let i = 0; i < 120; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * 2;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
            container.appendChild(star);
        }
    }

    function buildPressureGauge() {
        const svg = document.getElementById('p-gauge');
        for (let i = 0; i <= 20; i++) {
            const angle = -210 + (i * 12);
            const rad = (angle * Math.PI) / 180;
            const isBold = i % 5 === 0;
            const rOut = 45, rIn = isBold ? 32 : 38;
            const x1 = 50 + rOut * Math.cos(rad), y1 = 50 + rOut * Math.sin(rad);
            const x2 = 50 + rIn * Math.cos(rad), y2 = 50 + rIn * Math.sin(rad);
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", x1); line.setAttribute("y1", y1);
            line.setAttribute("x2", x2); line.setAttribute("y2", y2);
            line.setAttribute("class", isBold ? "tick tick-bold" : "tick");
            svg.appendChild(line);
        }
        const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
        g.id = "p-needle-rot";
        g.style.transformOrigin = "50px 50px";
        g.innerHTML = `<path d="M 48 50 L 50 15 L 52 50 Z" fill="#fff" /><circle cx="50" cy="50" r="4" fill="#fff" stroke="#020617" stroke-width="2" />`;
        svg.appendChild(g);
    }

    async function update() {
        try {
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${CITY.lat}&longitude=${CITY.lon}&current=temperature_2m,relative_humidity_2m,weather_code,pressure_msl,wind_speed_10m,wind_direction_10m,apparent_temperature&daily=temperature_2m_max,temperature_2m_min,weather_code,sunrise,sunset&timezone=auto&forecast_days=14`);
            const data = await res.json();

            document.getElementById('cur-temp').innerText = Math.round(data.current.temperature_2m);
            document.getElementById('feels-text').innerText = `–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ ${Math.round(data.current.apparent_temperature)}¬∞`;

            const mmHg = Math.round(data.current.pressure_msl * 0.750062);
            document.getElementById('p-val').innerText = mmHg;
            document.getElementById('p-needle-rot').style.transform = `rotate(${-120 + ((mmHg - 720) / 80 * 240)}deg)`;

            document.getElementById('wind-val').innerText = Math.round(data.current.wind_speed_10m);
            document.getElementById('wind-needle').style.transform = `rotate(${data.current.wind_direction_10m}deg)`;

            document.getElementById('hum-val').innerText = data.current.relative_humidity_2m + '%';
            document.getElementById('hum-fill').setAttribute('stroke-dasharray', `${data.current.relative_humidity_2m} 100`);

            updateSun(data.daily.sunrise[0], data.daily.sunset[0]);

            const list = document.getElementById('forecast-list');
            const gMax = Math.max(...data.daily.temperature_2m_max);
            const gMin = Math.min(...data.daily.temperature_2m_min);

            data.daily.time.forEach((t, i) => {
                const date = new Date(t);
                const day = i === 0 ? "–°–µ–≥–æ–¥–Ω—è" : date.toLocaleDateString('ru-RU', { weekday: 'short' });
                const min = data.daily.temperature_2m_min[i];
                const max = data.daily.temperature_2m_max[i];
                const left = ((min - gMin) / (gMax - gMin)) * 100;
                const width = ((max - min) / (gMax - gMin)) * 100;

                list.innerHTML += `
                    <div class="f-row">
                        <span class="f-day">${day}</span>
                        <span class="f-icon">${ICONS[data.daily.weather_code[i]] || '‚òÅÔ∏è'}</span>
                        <div class="f-bar-container">
                            <div class="f-bar-fill" style="left: ${left}%; width: ${width}%"></div>
                        </div>
                        <div class="f-temps">
                            <span class="f-min">${Math.round(min)}¬∞</span>
                            <span class="f-max">${Math.round(max)}¬∞</span>
                        </div>
                    </div>
                `;
            });
        } catch (e) { console.error(e); }
    }

    function updateSun(sr, ss) {
        const now = new Date(), rise = new Date(sr), set = new Date(ss);
        document.getElementById('rise').innerText = rise.toLocaleTimeString('ru-RU', {hour:'2-digit', minute:'2-digit'});
        document.getElementById('set').innerText = set.toLocaleTimeString('ru-RU', {hour:'2-digit', minute:'2-digit'});
        let prog = Math.min(Math.max((now - rise) / (set - rise), 0), 1);
        const path = document.getElementById('sun-path'), len = path.getTotalLength();
        path.style.strokeDasharray = `${len * prog} ${len}`;
        const pt = path.getPointAtLength(len * prog);
        const dot = document.getElementById('sun-dot');
        dot.setAttribute('cx', pt.x); dot.setAttribute('cy', pt.y);
    }

    createStars();
    buildPressureGauge();
    update();
</script>
</body>
</html>
